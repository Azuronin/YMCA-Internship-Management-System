@model IMS.Models.UserLogin
@{
    Layout = "~/Views/Shared/_MinimalLayout.cshtml";
    ViewData["Title"] = "Login";
    string msg = Context.Request.Query["msg"];
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link rel="stylesheet" href="~/css/Account/login.css" asp-append-version="true" />

@if (!string.IsNullOrEmpty(msg))
{
    <script>alert("@Html.Raw(Html.Encode(msg))");</script>
}

@if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
{
    <script>alert("@Html.Raw(Html.Encode(ViewBag.ErrorMessage))");</script>
}

<div class="login-wrapper">
    <div class="login-overlay">
        <div class="login-header">
            <img src="~/images/logo.png" alt="YMCA Logo" class="logo" />
            <div class="title-text">
                <h1>Internship Management</h1>
                <h1>System of YMCA Cebu</h1>
                <h1>Philippines</h1>
            </div>
        </div>
        <div class="form-container">
            <div class="form-header">
                <i class="fas fa-sign-in-alt header-icon"></i>
                <h1>Welcome Back</h1>
                <p>Enter your email and password to login</p>
            </div>

            <form asp-action="Login" method="post" id="loginForm">
                @Html.AntiForgeryToken()

                <div class="form-row">
                    <!-- Email -->
                    <div class="form-group full-width">
                        <div class="input-wrapper">
                            <i class="fas fa-user icon"></i>
                            <input asp-for="Email" placeholder="Enter your email" type="email" />
                            <div class="input-line"></div>
                        </div>
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-row">
                    <!-- Password -->
                    <div class="form-group full-width">
                        <div class="input-wrapper">
                            <i class="fas fa-lock icon"></i>
                            <input asp-for="Password" type="password" id="password" placeholder="Enter your password" />
                            <i class="fas fa-eye toggle-password" onclick="togglePassword('password', this)"></i>
                            <div class="input-line"></div>
                        </div>
                        <span asp-validation-for="Password" class="text-danger"></span>
                    </div>
                </div>

                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>

                <div class="form-footer">
                    <div class="footer-link">
                        <a href="#" onclick="openForgotPasswordModal()">
                            <i class="fas fa-key"></i> Forgot Password?
                        </a>
                    </div>
                    <div class="footer-link">
                        Applying for internship?
                        <a href="#" onclick="openApplyModal()">
                            <i class="fas fa-file-upload"></i> Click here
                        </a>
                    </div>
                    <div class="footer-link">
                        Don't have an account?
                        <a asp-action="Register" asp-controller="Account">
                            <i class="fas fa-user-plus"></i> Register
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Forgot Password Modal -->
<div id="forgotPasswordModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Reset Your Password</h3>
            <i class="fas fa-times close-btn" onclick="closeForgotPasswordModal()"></i>
        </div>

        <div id="step1" class="modal-step">
            <p>Enter your email address to recover your password:</p>
            <div class="form-group">
                <div class="input-wrapper">
                    <i class="fas fa-envelope icon"></i>
                    <input type="email" id="forgotEmail" placeholder="Enter your email" />
                    <div class="input-line"></div>
                </div>
                <span id="emailError" class="text-danger"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-primary" onclick="checkEmail()" id="checkEmailBtn">Next</button>
                <button type="button" class="btn-secondary" onclick="closeForgotPasswordModal()">Cancel</button>
            </div>
        </div>

        <div id="step2" class="modal-step" style="display: none;">
            <p>Answer your security question:</p>
            <div class="security-question">
                <strong id="displayQuestion"></strong>
            </div>
            <div class="form-group">
                <div class="input-wrapper">
                    <i class="fas fa-key icon"></i>
                    <input type="text" id="securityAnswer" placeholder="Enter your answer" />
                    <div class="input-line"></div>
                </div>
                <span id="answerError" class="text-danger"></span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-primary" onclick="verifyAnswer()" id="verifyAnswerBtn">Verify</button>
                <button type="button" class="btn-secondary" onclick="backToStep1()">Back</button>
            </div>
        </div>

        <div id="step3" class="modal-step" style="display: none;">
            <p>Your password has been recovered:</p>
            <div class="password-display">
                <div class="password-box">
                    <i class="fas fa-lock"></i>
                    <span id="recoveredPassword">********</span>
                    <button type="button" class="btn-show" onclick="toggleRecoveredPassword()">
                        <i class="fas fa-eye" id="showPasswordIcon"></i>
                    </button>
                </div>
            </div>
            <p class="warning-text">Please save this password and consider changing it after logging in.</p>
            <div class="modal-footer">
                <button type="button" class="btn-primary" onclick="closeForgotPasswordModal()">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Resume Upload Modal -->
<div id="resumeModal" class="modal-overlay d-none">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Apply for Internship</h3>
            <i class="fas fa-times close-btn" onclick="closeApplyModal()"></i>
        </div>
        <p>Please provide your details and upload your resume:</p>

        <div class="form-group">
            <div class="input-wrapper">
                <i class="fas fa-user icon"></i>
                <input type="text" id="applicantName" placeholder="Enter your full name" />
                <div class="input-line"></div>
            </div>
        </div>

        <!-- Add spacing between inputs -->
        <div style="margin-top: 15px;"></div>

        <div class="form-group">
            <div class="input-wrapper">
                <i class="fas fa-envelope icon"></i>
                <input type="email" id="applicantEmail" placeholder="Enter your email" />
                <div class="input-line"></div>
            </div>
        </div>

        <div class="file-upload-area" onclick="triggerFileUpload()">
            <input type="file" id="resumeUpload" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(this)" style="display: none;" />
            <div class="file-display">
                <i class="fas fa-cloud-upload-alt"></i>
                <span id="resumeFilename">Click here to select a file</span>
                <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">Supported formats: PDF, JPG, JPEG, PNG (Max: 10MB)</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-primary" onclick="submitResume()">Submit</button>
            <button type="button" class="btn-secondary" onclick="closeApplyModal()">Cancel</button>
        </div>
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
    <script
        src="~/js/Account/login.js" asp-append-version="true">
    </script>
}